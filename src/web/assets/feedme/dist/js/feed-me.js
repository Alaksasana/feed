!function(t){void 0===Craft.FeedMe&&(Craft.FeedMe={}),Craft.FeedMe.Help=Garnish.Base.extend({widgetId:0,loading:!1,$widget:null,$message:null,$fromEmail:null,$attachLogs:null,$attachDbBackup:null,$attachAdditionalFile:null,$sendBtn:null,$spinner:null,$error:null,$errorList:null,$iframe:null,init:function(){this.widgetId="feedMeHelp",Craft.FeedMe.Help.widgets[this.widgetId]=this,this.$widget=t(".feedme-help-form"),this.$message=this.$widget.find(".message:first"),this.$fromEmail=this.$widget.find(".fromEmail:first"),this.$attachLogs=this.$widget.find(".attachLogs:first"),this.$attachAdditionalFile=this.$widget.find(".attachAdditionalFile:first"),this.$sendBtn=this.$widget.find(".submit:first"),this.$spinner=this.$widget.find(".buttons .spinner"),this.$error=this.$widget.find(".error:first"),this.$form=this.$widget.find("form:first"),this.$form.prepend('<input type="hidden" name="widgetId" value="'+this.widgetId+'" />'),this.$form.prepend(Craft.getCsrfInput()),this.addListener(this.$sendBtn,"activate","sendMessage")},sendMessage:function(){var e="iframeWidget"+this.widgetId;this.loading||(this.$iframe||(this.$iframe=t('<iframe id="'+e+'" name="'+e+'" style="display: none" />').insertAfter(this.$form)),this.loading=!0,this.$sendBtn.addClass("active"),this.$spinner.removeClass("hidden"),this.$form.attr("target",e),this.$form.attr("action",Craft.getActionUrl("feed-me/help/send-support-request")),this.$form.submit())},parseResponse:function(e,i){if(this.loading=!1,this.$sendBtn.removeClass("active"),this.$spinner.addClass("hidden"),this.$errorList&&this.$errorList.children().remove(),e.errors)for(var s in this.$errorList||(this.$errorList=t('<ul class="errors"/>').insertAfter(this.$form)),e.errors)if(e.errors.hasOwnProperty(s))for(var n=0;n<e.errors[s].length;n++){var r=e.errors[s][n];t("<li>"+r+"</li>").appendTo(this.$errorList)}e.success&&(Craft.cp.displayNotice(Craft.t("feed-me","Message sent successfully.")),this.$message.val(""),this.$attachAdditionalFile.val("")),this.$iframe.html("")}},{widgets:{}})}(jQuery),function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(!(t=s(String(t||"").toLowerCase()))||!t.length)return[];var e,i,r,a,l=[],h=t.split(/ +/);for(e=0,i=h.length;e<i;e++){if(r=n(h[e]),this.settings.diacritics)for(a in o)o.hasOwnProperty(a)&&(r=r.replace(new RegExp(a,"g"),o[a]));l.push({string:h[e],regex:new RegExp(r,"i")})}return l},t.prototype.iterator=function(t,e){var i;(i=r(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var i,s,n,r;i=this,t=this.prepareSearch(t,e),n=t.tokens,s=t.options.fields,r=n.length;var o=function(t,e){var i,s;return t?-1===(s=(t=String(t||"")).search(e.regex))?0:(i=e.string.length/t.length,0===s&&(i+=.5),i):0},a=(l=s.length)?1===l?function(t,e){return o(e[s[0]],t)}:function(t,e){for(var i=0,n=0;i<l;i++)n+=o(e[s[i]],t);return n/l}:function(){return 0},l;return r?1===r?function(t){return a(n[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,s=0;i<r;i++){if((e=a(n[i],t))<=0)return 0;s+=e}return s/r}:function(t){for(var e=0,i=0;e<r;e++)i+=a(n[e],t);return i/r}:function(){return 0}},t.prototype.getSortFunction=function(t,i){var s,n,r,o,a,l,h,c,d,p,u;if(u=!(t=(r=this).prepareSearch(t,i)).query&&i.sort_empty||i.sort,d=function(t,e){return"$score"===t?e.score:r.items[e.id][t]},a=[],u)for(s=0,n=u.length;s<n;s++)(t.query||"$score"!==u[s].field)&&a.push(u[s]);if(t.query){for(p=!0,s=0,n=a.length;s<n;s++)if("$score"===a[s].field){p=!1;break}p&&a.unshift({field:"$score",direction:"desc"})}else for(s=0,n=a.length;s<n;s++)if("$score"===a[s].field){a.splice(s,1);break}for(c=[],s=0,n=a.length;s<n;s++)c.push("desc"===a[s].direction?-1:1);return(l=a.length)?1===l?(o=a[0].field,h=c[0],function(t,i){return h*e(d(o,t),d(o,i))}):function(t,i){var s,n,r,o,h;for(s=0;s<l;s++)if(h=a[s].field,n=c[s]*e(d(h,t),d(h,i)))return n;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;var s=(e=i({},e)).fields,n=e.sort,o=e.sort_empty;return s&&!r(s)&&(e.fields=[s]),n&&!r(n)&&(e.sort=[n]),o&&!r(o)&&(e.sort_empty=[o]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var i=this,s,n,r,o,a,l;return r=this.prepareSearch(t,e),e=r.options,t=r.query,l=e.score||this.getScoreFunction(r),t.length?this.iterator(this.items,function(t,i){n=l(t),(!1===e.filter||n>0)&&r.items.push({score:n,id:i})}):this.iterator(this.items,function(t,e){r.items.push({score:1,id:e})}),(a=this.getSortFunction(r,e))&&r.items.sort(a),r.total=r.items.length,"number"==typeof e.limit&&(r.items=r.items.slice(0,e.limit)),r};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:t<e?-1:0:(t=a(String(t||"")))>(e=a(String(e||"")))?1:e>t?-1:0},i=function(t,e){var i,s,n,r;for(i=1,s=arguments.length;i<s;i++)if(r=arguments[i])for(n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);return t},s=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},n=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},r=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},a=function(){var t,e,i,s,n="",r={};for(i in o)if(o.hasOwnProperty(i))for(n+=s=o[i].substring(2,o[i].length-1),t=0,e=s.length;t<e;t++)r[s.charAt(t)]=i;var a=new RegExp("["+n+"]","g");return function(t){return t.replace(a,function(t){return r[t]}).toLowerCase()}}();return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={mixin:function(t){t.plugins={},t.prototype.initializePlugins=function(t){var i,s,n,r=this,o=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(i=0,s=t.length;i<s;i++)"string"==typeof t[i]?o.push(t[i]):(this.plugins.settings[t[i].name]=t[i].options,o.push(t[i].name));else if(t)for(n in t)t.hasOwnProperty(n)&&(this.plugins.settings[n]=t[n],o.push(n));for(;o.length;)this.require(o.shift())},t.prototype.loadPlugin=function(e){var i=this,s=this.plugins,n=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');s.requested[e]=!0,s.loaded[e]=n.fn.apply(this,[this.plugins.settings[e]||{}]),s.names.push(e)},t.prototype.require=function(t){var e=this,i=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(i.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return i.loaded[t]},t.define=function(e,i){t.plugins[e]={name:e,fn:i}}}},e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,i){"use strict";var s=function(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?new RegExp(e,"i"):e,s=function(t){var e=0;if(3===t.nodeType){var n=t.data.search(i);if(n>=0&&t.data.length>0){var r=t.data.match(i),o=document.createElement("span");o.className="highlight";var a=t.splitText(n),l=a.splitText(r[0].length),h=a.cloneNode(!0);o.appendChild(h),a.parentNode.replaceChild(o,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var c=0;c<t.childNodes.length;++c)c+=s(t.childNodes[c]);return e};return t.each(function(){s(this)})}},n=function(){};n.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["on","off","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]};var r=/Mac/.test(navigator.userAgent),o=65,a=188,l=13,h=27,c=37,d=38,p=80,u=39,g=40,f=78,v=8,m=46,$=16,y=r?91:17,w=r?18:17,C=9,O=1,b=2,x=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,S=function(t){return void 0!==t},I=function(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""},k=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},_=function(t){return(t+"").replace(/\$/g,"$$$$")},F={before:function(t,e,i){var s=t[e];t[e]=function(){return i.apply(t,arguments),s.apply(t,arguments)}},after:function(t,e,i){var s=t[e];t[e]=function(){var e=s.apply(t,arguments);return i.apply(t,arguments),e}}},D=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},P=function(t,e){var i;return function(){var s=this,n=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(s,n)},e)}},A=function(t,e,i){var s,n=t.trigger,r={};for(s in t.trigger=function(i){var s=i;if(-1===e.indexOf(s))return n.apply(t,arguments);r[s]=arguments},i.apply(t,[]),t.trigger=n,r)r.hasOwnProperty(s)&&n.apply(t,r[s])},T=function(t,e,i,s){t.on(e,i,function(e){for(var i=e.target;i&&i.parentNode!==t[0];)i=i.parentNode;return e.currentTarget=i,s.apply(this,[e])})},z=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),s=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-s,e.length=s}return e},q=function(t,e,i){var s,n,r={};if(i)for(s=0,n=i.length;s<n;s++)r[i[s]]=t.css(i[s]);else r=t.css();e.css(r)},j=function(e,i){if(!e)return 0;var s=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");q(i,s,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var n=s.width();return s.remove(),n},L=function(t){var e=null,i=function(i,s){var n,r,o,a,l,h,c,d;s=s||{},(i=i||window.event||{}).metaKey||i.altKey||(s.force||!1!==t.data("grow"))&&(n=t.val(),i.type&&"keydown"===i.type.toLowerCase()&&(o=(r=i.keyCode)>=97&&r<=122||r>=65&&r<=90||r>=48&&r<=57||32===r,46===r||8===r?(d=z(t[0])).length?n=n.substring(0,d.start)+n.substring(d.start+d.length):8===r&&d.start?n=n.substring(0,d.start-1)+n.substring(d.start+1):46===r&&void 0!==d.start&&(n=n.substring(0,d.start)+n.substring(d.start+1)):o&&(h=i.shiftKey,c=String.fromCharCode(i.keyCode),n+=c=h?c.toUpperCase():c.toLowerCase())),a=t.attr("placeholder"),!n&&a&&(n=a),(l=j(n,t)+4)!==e&&(e=l,t.width(l),t.triggerHandler("resize")))};t.on("keydown keyup update blur",i),i()},E=function(i,s){var n,r,o,a,l,h=this;(l=i[0]).selectize=this;var c=window.getComputedStyle&&window.getComputedStyle(l,null);if(a=(a=c?c.getPropertyValue("direction"):l.currentStyle&&l.currentStyle.direction)||i.parents("[dir]:first").attr("dir")||"",t.extend(this,{order:0,settings:s,$input:i,tabIndex:i.attr("tabindex")||"",tagType:"select"===l.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(a),eventNS:".selectize"+ ++E.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:i.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===s.loadThrottle?this.onSearchChange:P(this.onSearchChange,s.loadThrottle)}),this.sifter=new e(this.options,{diacritics:s.diacritics}),this.settings.options){for(r=0,o=this.settings.options.length;r<o;r++)this.registerOption(this.settings.options[r]);delete this.settings.options}if(this.settings.optgroups){for(r=0,o=this.settings.optgroups.length;r<o;r++)this.registerOptionGroup(this.settings.optgroups[r]);delete this.settings.optgroups}this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),this.initializePlugins(this.settings.plugins),this.setupCallbacks(),this.setupTemplates(),this.setup()};return n.mixin(E),i.mixin(E),t.extend(E.prototype,{setup:function(){var e=this,i=e.settings,s=e.eventNS,n=t(window),o=t(document),a=e.$input,l,h,c,d,p,u,g,f,v,m,$;if(g=e.settings.mode,m=a.attr("class")||"",l=t("<div>").addClass(i.wrapperClass).addClass(m).addClass(g),h=t("<div>").addClass(i.inputClass).addClass("items").appendTo(l),c=t('<input type="text" autocomplete="false" />').appendTo(h).attr("tabindex",a.is(":disabled")?"-1":e.tabIndex),u=t(i.dropdownParent||l),d=t("<div>").addClass(i.dropdownClass).addClass(g).hide().appendTo(u),p=t("<div>").addClass(i.dropdownContentClass).appendTo(d),e.settings.copyClassesToDropdown&&d.addClass(m),l.css({width:a[0].style.width}),e.plugins.names.length&&($="plugin-"+e.plugins.names.join(" plugin-"),l.addClass($),d.addClass($)),(null===i.maxItems||i.maxItems>1)&&1===e.tagType&&a.attr("multiple","multiple"),e.settings.placeholder&&c.attr("placeholder",i.placeholder),!e.settings.splitOn&&e.settings.delimiter){var C=e.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");e.settings.splitOn=new RegExp("\\s*"+C+"+\\s*")}a.attr("autocorrect")&&c.attr("autocorrect",a.attr("autocorrect")),a.attr("autocapitalize")&&c.attr("autocapitalize",a.attr("autocapitalize")),e.$wrapper=l,e.$control=h,e.$control_input=c,e.$dropdown=d,e.$dropdown_content=p,d.on("mouseenter","[data-selectable]",function(){return e.onOptionHover.apply(e,arguments)}),d.on("mousedown click","[data-selectable]",function(){return e.onOptionSelect.apply(e,arguments)}),T(h,"mousedown","*:not(input)",function(){return e.onItemSelect.apply(e,arguments)}),L(c),h.on({mousedown:function(){return e.onMouseDown.apply(e,arguments)},click:function(){return e.onClick.apply(e,arguments)}}),c.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return e.onKeyDown.apply(e,arguments)},keyup:function(){return e.onKeyUp.apply(e,arguments)},keypress:function(){return e.onKeyPress.apply(e,arguments)},resize:function(){e.positionDropdown.apply(e,[])},blur:function(){return e.onBlur.apply(e,arguments)},focus:function(){return e.ignoreBlur=!1,e.onFocus.apply(e,arguments)},paste:function(){return e.onPaste.apply(e,arguments)}}),o.on("keydown"+s,function(t){e.isCmdDown=t[r?"metaKey":"ctrlKey"],e.isCtrlDown=t[r?"altKey":"ctrlKey"],e.isShiftDown=t.shiftKey}),o.on("keyup"+s,function(t){t.keyCode===w&&(e.isCtrlDown=!1),16===t.keyCode&&(e.isShiftDown=!1),t.keyCode===y&&(e.isCmdDown=!1)}),o.on("mousedown"+s,function(t){if(e.isFocused){if(t.target===e.$dropdown[0]||t.target.parentNode===e.$dropdown[0])return!1;e.$control.has(t.target).length||t.target===e.$control[0]||e.blur(t.target)}}),n.on(["scroll"+s,"resize"+s].join(" "),function(){e.isOpen&&e.positionDropdown.apply(e,arguments)}),n.on("mousemove"+s,function(){e.ignoreHover=!1}),this.revertSettings={$children:a.children().detach(),tabindex:a.attr("tabindex")},a.attr("tabindex",-1).hide().after(e.$wrapper),t.isArray(i.items)&&(e.setValue(i.items),delete i.items),x&&a.on("invalid"+s,function(t){t.preventDefault(),e.isInvalid=!0,e.refreshState()}),e.updateOriginalInput(),e.refreshItems(),e.refreshState(),e.updatePlaceholder(),e.isSetup=!0,a.is(":disabled")&&e.disable(),e.on("change",this.onChange),a.data("selectize",e),a.addClass("selectized"),e.trigger("initialize"),!0===i.preload&&e.onSearchChange("")},setupTemplates:function(){var e=this,i=this.settings.labelField,s=this.settings.optgroupLabelField,n={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[s])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[i])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[i])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=t.extend({},n,this.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]])&&this.on(t,e)},onClick:function(t){var e=this;this.isFocused||(this.focus(),t.preventDefault())},onMouseDown:function(e){var i=this,s=e.isDefaultPrevented(),n=t(e.target);if(i.isFocused){if(e.target!==i.$control_input[0])return"single"===i.settings.mode?i.isOpen?i.close():i.open():s||i.setActiveItem(null),!1}else s||window.setTimeout(function(){i.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(e){var i=this;i.isFull()||i.isInputHidden||i.isLocked?e.preventDefault():i.settings.splitOn&&setTimeout(function(){for(var e=t.trim(i.$control_input.val()||"").split(i.settings.splitOn),s=0,n=e.length;s<n;s++)i.createItem(e[s])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e=t.target===this.$control_input[0],i=this;if(this.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(this.isCmdDown)return void this.selectAll();break;case 27:return void(this.isOpen&&(t.preventDefault(),t.stopPropagation(),this.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=!0;var s=this.getAdjacentOption(this.$activeOption,1);s.length&&this.setActiveOption(s,!0,!0)}return void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:if(this.$activeOption){this.ignoreHover=!0;var n=this.getAdjacentOption(this.$activeOption,-1);n.length&&this.setActiveOption(n,!0,!0)}return void t.preventDefault();case 13:return void(this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),t.preventDefault()));case 37:return void this.advanceSelection(-1,t);case 39:return void this.advanceSelection(1,t);case 9:return this.settings.selectOnTab&&this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),this.isFull()||t.preventDefault()),void(this.settings.create&&this.createItem()&&t.preventDefault());case 8:case 46:return void this.deleteSelection(t)}!this.isFull()&&!this.isInputHidden||(r?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){var e=this;if(this.isLocked)return t&&t.preventDefault();var i=this.$control_input.val()||"";this.lastValue!==i&&(this.lastValue=i,this.onSearchChange(i),this.refreshOptions(),this.trigger("type",i))},onSearchChange:function(t){var e=this,i=e.settings.load;i&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(s){i.apply(e,[t,s])})))},onFocus:function(t){var e=this,i=this.isFocused;if(this.isDisabled)return this.blur(),t&&t.preventDefault(),!1;this.ignoreFocus||(this.isFocused=!0,"focus"===this.settings.preload&&this.onSearchChange(""),i||this.trigger("focus"),this.$activeItems.length||(this.showInput(),this.setActiveItem(null),this.refreshOptions(!!this.settings.openOnFocus)),this.refreshState())},onBlur:function(t,e){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(t);var s=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),(e||document.body).focus(),i.ignoreFocus=!1,i.trigger("blur")};i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,s):s()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var i,s,n,r=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),(s=t(e.currentTarget)).hasClass("create")?r.createItem(null,function(){r.settings.closeAfterSelect&&r.close()}):void 0!==(i=s.attr("data-value"))&&(r.lastQuery=null,r.setTextboxValue(""),r.addItem(i),r.settings.closeAfterSelect?r.close():!r.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&r.setActiveOption(r.getOption(i)))},onItemSelect:function(t){var e=this;this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input,i;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){var i;A(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},setActiveItem:function(e,i){var s=this,n,r,o,a,l,h,c,d;if("single"!==this.settings.mode){if(!(e=t(e)).length)return t(this.$activeItems).removeClass("active"),this.$activeItems=[],void(this.isFocused&&this.showInput());if("mousedown"===(n=i&&i.type.toLowerCase())&&this.isShiftDown&&this.$activeItems.length){for(d=this.$control.children(".active:last"),(a=Array.prototype.indexOf.apply(this.$control[0].childNodes,[d[0]]))>(l=Array.prototype.indexOf.apply(this.$control[0].childNodes,[e[0]]))&&(c=a,a=l,l=c),r=a;r<=l;r++)h=this.$control[0].childNodes[r],-1===this.$activeItems.indexOf(h)&&(t(h).addClass("active"),this.$activeItems.push(h));i.preventDefault()}else"mousedown"===n&&this.isCtrlDown||"keydown"===n&&this.isShiftDown?e.hasClass("active")?(o=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(o,1),e.removeClass("active")):this.$activeItems.push(e.addClass("active")[0]):(t(this.$activeItems).removeClass("active"),this.$activeItems=[e.addClass("active")[0]]);this.hideInput(),this.isFocused||this.focus()}},setActiveOption:function(e,i,s){var n,r,o,a,l,h=this;this.$activeOption&&this.$activeOption.removeClass("active"),this.$activeOption=null,(e=t(e)).length&&(this.$activeOption=e.addClass("active"),!i&&S(i)||(n=this.$dropdown_content.height(),r=this.$activeOption.outerHeight(!0),i=this.$dropdown_content.scrollTop()||0,a=o=this.$activeOption.offset().top-this.$dropdown_content.offset().top+i,l=o-n+r,o+r>n+i?this.$dropdown_content.stop().animate({scrollTop:l},s?this.settings.scrollDuration:0):o<i&&this.$dropdown_content.stop().animate({scrollTop:a},s?this.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==this.settings.mode&&(this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.$activeItems.length&&(this.hideInput(),this.close()),this.focus())},hideInput:function(){var t=this;this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(e){var i,s,n,r,o,a=this,l=this.settings,h=this.getSearchOptions();if(l.score&&"function"!=typeof(o=this.settings.score.apply(this,[e])))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==this.lastQuery?(this.lastQuery=e,r=this.sifter.search(e,t.extend(h,{score:o})),this.currentResults=r):r=t.extend(!0,{},this.currentResults),l.hideSelected)for(i=r.items.length-1;i>=0;i--)-1!==this.items.indexOf(I(r.items[i].id))&&r.items.splice(i,1);return r},refreshOptions:function(e){var i,n,r,o,a,l,h,c,d,p,u,g,f,v,m,$;void 0===e&&(e=!0);var y=this,w=t.trim(y.$control_input.val()),C=y.search(w),O=y.$dropdown_content,b=y.$activeOption&&I(y.$activeOption.attr("data-value"));for(o=C.items.length,"number"==typeof y.settings.maxOptions&&(o=Math.min(o,y.settings.maxOptions)),a={},l=[],i=0;i<o;i++)for(h=y.options[C.items[i].id],c=y.render("option",h),d=h[y.settings.optgroupField]||"",n=0,r=(p=t.isArray(d)?d:[d])&&p.length;n<r;n++)d=p[n],y.optgroups.hasOwnProperty(d)||(d=""),a.hasOwnProperty(d)||(a[d]=[],l.push(d)),a[d].push(c);for(this.settings.lockOptgroupOrder&&l.sort(function(t,e){var i,s;return(y.optgroups[t].$order||0)-(y.optgroups[e].$order||0)}),u=[],i=0,o=l.length;i<o;i++)d=l[i],y.optgroups.hasOwnProperty(d)&&a[d].length?(g=y.render("optgroup_header",y.optgroups[d])||"",g+=a[d].join(""),u.push(y.render("optgroup",t.extend({},y.optgroups[d],{html:g})))):u.push(a[d].join(""));if(O.html(u.join("")),y.settings.highlight&&C.query.length&&C.tokens.length)for(i=0,o=C.tokens.length;i<o;i++)s(O,C.tokens[i].regex);if(!y.settings.hideSelected)for(i=0,o=y.items.length;i<o;i++)y.getOption(y.items[i]).addClass("selected");(f=y.canCreate(w))&&(O.prepend(y.render("option_create",{input:w})),$=t(O[0].childNodes[0])),y.hasOptions=C.items.length>0||f,y.hasOptions?(C.items.length>0?((m=b&&y.getOption(b))&&m.length?v=m:"single"===y.settings.mode&&y.items.length&&(v=y.getOption(y.items[0])),v&&v.length||(v=$&&!y.settings.addPrecedence?y.getAdjacentOption($,1):O.find("[data-selectable]:first"))):v=$,y.setActiveOption(v),e&&!y.isOpen&&y.open()):(y.setActiveOption(null),e&&y.isOpen&&y.close())},addOption:function(e){var i,s,n,r=this;if(t.isArray(e))for(i=0,s=e.length;i<s;i++)this.addOption(e[i]);else(n=this.registerOption(e))&&(this.userOptions[n]=!0,this.lastQuery=null,this.trigger("option_add",n,e))},registerOption:function(t){var e=I(t[this.settings.valueField]);return null!=e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=I(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(e,i){var s=this,n,r,o,a,l,h,c;if(e=I(e),o=I(i[this.settings.valueField]),null!==e&&this.options.hasOwnProperty(e)){if("string"!=typeof o)throw new Error("Value must be set in option data");c=this.options[e].$order,o!==e&&(delete this.options[e],-1!==(a=this.items.indexOf(e))&&this.items.splice(a,1,o)),i.$order=i.$order||c,this.options[o]=i,l=this.renderCache.item,h=this.renderCache.option,l&&(delete l[e],delete l[o]),h&&(delete h[e],delete h[o]),-1!==this.items.indexOf(o)&&(n=this.getItem(e),r=t(this.render("item",i)),n.hasClass("active")&&r.addClass("active"),n.replaceWith(r)),this.lastQuery=null,this.isOpen&&this.refreshOptions(!1)}},removeOption:function(t,e){var i=this;t=I(t);var s=this.renderCache.item,n=this.renderCache.option;s&&delete s[t],n&&delete n[t],delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("option_remove",t),this.removeItem(t,e)},clearOptions:function(){var t=this;this.loadedSearches={},this.userOptions={},this.renderCache={},this.options=this.sifter.items={},this.lastQuery=null,this.trigger("option_clear"),this.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,i){var s=this.$dropdown.find("[data-selectable]"),n=s.index(e)+i;return n>=0&&n<s.length?s.eq(n):t()},getElementWithValue:function(e,i){if(null!=(e=I(e)))for(var s=0,n=i.length;s<n;s++)if(i[s].getAttribute("data-value")===e)return t(i[s]);return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(e,i){for(var s=t.isArray(e)?e:[e],n=0,r=s.length;n<r;n++)this.isPending=n<r-1,this.addItem(s[n],i)},addItem:function(e,i){var s;A(this,i?[]:["change"],function(){var s,n,r,o=this,a=this.settings.mode,l,h,c,d;e=I(e),-1===this.items.indexOf(e)?this.options.hasOwnProperty(e)&&("single"===a&&this.clear(i),"multi"===a&&this.isFull()||(s=t(this.render("item",this.options[e])),d=this.isFull(),this.items.splice(this.caretPos,0,e),this.insertAtCaret(s),(!this.isPending||!d&&this.isFull())&&this.refreshState(),this.isSetup&&(r=this.$dropdown_content.find("[data-selectable]"),this.isPending||(n=this.getOption(e),c=this.getAdjacentOption(n,1).attr("data-value"),this.refreshOptions(this.isFocused&&"single"!==a),c&&this.setActiveOption(this.getOption(c))),!r.length||this.isFull()?this.close():this.positionDropdown(),this.updatePlaceholder(),this.trigger("item_add",e,s),this.updateOriginalInput({silent:i})))):"single"===a&&this.close()})},removeItem:function(t,e){var i=this,s,n,r;s="object"==typeof t?t:this.getItem(t),t=I(s.attr("data-value")),-1!==(n=this.items.indexOf(t))&&(s.remove(),s.hasClass("active")&&(r=this.$activeItems.indexOf(s[0]),this.$activeItems.splice(r,1)),this.items.splice(n,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(t)&&this.removeOption(t,e),n<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshState(),this.updatePlaceholder(),this.updateOriginalInput({silent:e}),this.positionDropdown(),this.trigger("item_remove",t,s))},createItem:function(e,i){var s=this,n=s.caretPos;e=e||t.trim(s.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof i&&(i=!0),!s.canCreate(e))return r(),!1;s.lock();var o="function"==typeof s.settings.create?this.settings.create:function(t){var e={};return e[s.settings.labelField]=t,e[s.settings.valueField]=t,e},a=D(function(t){if(s.unlock(),!t||"object"!=typeof t)return r();var e=I(t[s.settings.valueField]);if("string"!=typeof e)return r();s.setTextboxValue(""),s.addOption(t),s.setCaret(n),s.addItem(e),s.refreshOptions(i&&"single"!==s.settings.mode),r(t)}),l=o.apply(this,[e,a]);return void 0!==l&&a(l),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var t,e=this;this.isRequired&&(this.items.length&&(this.isInvalid=!1),this.$control_input.prop("required",void 0)),this.refreshClasses()},refreshClasses:function(){var e=this,i=this.isFull(),s=this.isLocked;this.$wrapper.toggleClass("rtl",this.rtl),
this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("required",this.isRequired).toggleClass("invalid",this.isInvalid).toggleClass("locked",s).toggleClass("full",i).toggleClass("not-full",!i).toggleClass("input-active",this.isFocused&&!this.isInputHidden).toggleClass("dropdown-active",this.isOpen).toggleClass("has-options",!t.isEmptyObject(this.options)).toggleClass("has-items",this.items.length>0),this.$control_input.data("grow",!i&&!s)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,i,s,n,r=this;if(t=t||{},1===this.tagType){for(s=[],e=0,i=this.items.length;e<i;e++)n=this.options[this.items[e]][this.settings.labelField]||"",s.push('<option value="'+k(this.items[e])+'" selected="selected">'+k(n)+"</option>");s.length||this.$input.attr("multiple")||s.push('<option value="" selected="selected"></option>'),this.$input.html(s.join(""))}else this.$input.val(this.getValue()),this.$input.attr("value",this.$input.val());this.isSetup&&(t.silent||this.trigger("change",this.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(),this.isOpen=!0,this.refreshState(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){var t=this,e=this.isOpen;"single"===this.settings.mode&&this.items.length&&this.hideInput(),this.isOpen=!1,this.$dropdown.hide(),this.setActiveOption(null),this.refreshState(),e&&this.trigger("dropdown_close",this.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(t){var e=this;this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.lastQuery=null,this.setCaret(0),this.setActiveItem(null),this.updatePlaceholder(),this.updateOriginalInput({silent:t}),this.refreshState(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(e){var i=Math.min(this.caretPos,this.items.length);0===i?this.$control.prepend(e):t(this.$control[0].childNodes[i]).before(e),this.setCaret(i+1)},deleteSelection:function(e){var i,s,n,r,o,a,l,h,c,d=this;if(n=e&&8===e.keyCode?-1:1,r=z(this.$control_input[0]),this.$activeOption&&!this.settings.hideSelected&&(l=this.getAdjacentOption(this.$activeOption,-1).attr("data-value")),o=[],this.$activeItems.length){for(c=this.$control.children(".active:"+(n>0?"last":"first")),a=this.$control.children(":not(input)").index(c),n>0&&a++,i=0,s=this.$activeItems.length;i<s;i++)o.push(t(this.$activeItems[i]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(n<0&&0===r.start&&0===r.length?o.push(this.items[this.caretPos-1]):n>0&&r.start===this.$control_input.val().length&&o.push(this.items[this.caretPos]));if(!o.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete.apply(this,[o]))return!1;for(void 0!==a&&this.setCaret(a);o.length;)this.removeItem(o.pop());return this.showInput(),this.positionDropdown(),this.refreshOptions(!0),l&&(h=this.getOption(l)).length&&this.setActiveOption(h),!0},advanceSelection:function(t,e){var i,s,n,r,o,a,l=this;0!==t&&(this.rtl&&(t*=-1),i=t>0?"last":"first",s=z(this.$control_input[0]),this.isFocused&&!this.isInputHidden?(r=this.$control_input.val().length,(o=t<0?0===s.start&&0===s.length:s.start===r)&&!r&&this.advanceCaret(t,e)):(a=this.$control.children(".active:"+i)).length&&(n=this.$control.children(":not(input)").index(a),this.setActiveItem(null),this.setCaret(t>0?n+1:n)))},advanceCaret:function(t,e){var i=this,s,n;0!==t&&(s=t>0?"next":"prev",this.isShiftDown?(n=this.$control_input[s]()).length&&(this.hideInput(),this.setActiveItem(n),e&&e.preventDefault()):this.setCaret(this.caretPos+t))},setCaret:function(e){var i=this,s,n,r,o,a;if(e="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,e)),!this.isPending)for(s=0,n=(o=this.$control.children(":not(input)")).length;s<n;s++)a=t(o[s]).detach(),s<e?this.$control_input.before(a):this.$control.append(a);this.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var t=this;this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){var t=this;this.$input.prop("disabled",!1),this.$control_input.prop("disabled",!1).prop("tabindex",this.tabIndex),this.isDisabled=!1,this.unlock()},destroy:function(){var e=this,i=this.eventNS,s=this.revertSettings;this.trigger("destroy"),this.off(),this.$wrapper.remove(),this.$dropdown.remove(),this.$input.html("").append(s.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:s.tabindex}).show(),this.$control_input.removeData("grow"),this.$input.removeData("selectize"),t(window).off(i),t(document).off(i),t(document.body).off(i),delete this.$input[0].selectize},render:function(t,e){var i,s,n,r="",o=!1,a=this,l=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return"option"!==t&&"item"!==t||(o=!!(i=I(e[this.settings.valueField]))),o&&(S(this.renderCache[t])||(this.renderCache[t]={}),this.renderCache[t].hasOwnProperty(i))?this.renderCache[t][i]:(r=this.settings.render[t].apply(this,[e,k]),"option"!==t&&"option_create"!==t||(r=r.replace(l,"<$1 data-selectable")),"optgroup"===t&&(s=e[this.settings.optgroupValueField]||"",r=r.replace(l,'<$1 data-group="'+_(k(s))+'"')),"option"!==t&&"item"!==t||(r=r.replace(l,'<$1 data-value="'+_(k(i||""))+'"')),o&&(this.renderCache[t][i]=r),r)},clearCache:function(t){var e=this;void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){var e=this;if(!this.settings.create)return!1;var i=this.settings.createFilter;return t.length&&("function"!=typeof i||i.apply(this,[t]))&&("string"!=typeof i||new RegExp(i).test(t))&&(!(i instanceof RegExp)||i.test(t))}}),E.count=0,E.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},t.fn.selectize=function(e){var i=t.fn.selectize.defaults,s=t.extend({},i,e),n=s.dataAttr,r=s.labelField,o=s.valueField,a=s.optgroupField,l=s.optgroupLabelField,h=s.optgroupValueField,c=function(e,i){var a,l,h,c,d=e.attr(n);if(d)for(i.options=JSON.parse(d),a=0,l=i.options.length;a<l;a++)i.items.push(i.options[a][o]);else{var p=t.trim(e.val()||"");if(!s.allowEmptyOption&&!p.length)return;for(a=0,l=(h=p.split(s.delimiter)).length;a<l;a++)(c={})[r]=h[a],c[o]=h[a],i.options.push(c);i.items=h}},d=function(e,i){var c,d,p,u,g=0,f=i.options,v={},m=function(t){var e=n&&t.attr(n);return"string"==typeof e&&e.length?JSON.parse(e):null},$=function(e,n){e=t(e);var l=I(e.attr("value"));if(l||s.allowEmptyOption)if(v.hasOwnProperty(l)){if(n){var h=v[l][a];h?t.isArray(h)?h.push(n):v[l][a]=[h,n]:v[l][a]=n}}else{var c=m(e)||{};c[r]=c[r]||e.text(),c[o]=c[o]||l,c[a]=c[a]||n,v[l]=c,f.push(c),e.is(":selected")&&i.items.push(l)}},y=function(e){var s,n,r,o,a;for((r=(e=t(e)).attr("label"))&&((o=m(e)||{})[l]=r,o[h]=r,i.optgroups.push(o)),s=0,n=(a=t("option",e)).length;s<n;s++)$(a[s],r)};for(i.maxItems=e.attr("multiple")?null:1,c=0,d=(u=e.children()).length;c<d;c++)"optgroup"===(p=u[c].tagName.toLowerCase())?y(u[c]):"option"===p&&$(u[c])};return this.each(function(){if(!this.selectize){var n,r=t(this),o=this.tagName.toLowerCase(),a=r.attr("placeholder")||r.attr("data-placeholder");a||s.allowEmptyOption||(a=r.children('option[value=""]').text());var l={placeholder:a,options:[],optgroups:[],items:[]};"select"===o?d(r,l):c(r,l),n=new E(r,t.extend(!0,{},i,l,e))}})},t.fn.selectize.defaults=E.defaults,t.fn.selectize.support={validity:x},E.define("drag_drop",function(e){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var i=this,s;i.lock=(s=i.lock,function(){var t=i.$control.data("sortable");return t&&t.disable(),s.apply(i,arguments)}),i.unlock=function(){var t=i.unlock;return function(){var e=i.$control.data("sortable");return e&&e.enable(),t.apply(i,arguments)}}(),i.setup=function(){var e=i.setup;return function(){e.apply(this,arguments);var s=i.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),s.css({overflow:"visible"})},stop:function(){s.css({overflow:"hidden"});var e=i.$activeItems?i.$activeItems.slice():null,n=[];s.children("[data-value]").each(function(){n.push(t(this).attr("data-value"))}),i.setValue(n),i.setActiveItem(e)}})}}()}}),E.define("dropdown_header",function(e){var i=this,s;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),i.setup=(s=i.setup,function(){s.apply(i,arguments),i.$dropdown_header=t(e.html(e)),i.$dropdown.prepend(i.$dropdown_header)})}),E.define("optgroup_columns",function(e){var i=this,s;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,i){var s=e.closest("[data-group]").find("[data-selectable]"),n=s.index(e)+i;return n>=0&&n<s.length?s.eq(n):t()},this.onKeyDown=(s=i.onKeyDown,function(t){var e,n,r,o;return!this.isOpen||37!==t.keyCode&&39!==t.keyCode?s.apply(this,arguments):(i.ignoreHover=!0,e=(o=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),void((n=(r=(o=37===t.keyCode?o.prev("[data-group]"):o.next("[data-group]")).find("[data-selectable]")).eq(Math.min(r.length-1,e))).length&&this.setActiveOption(n)))});var n=function(){var t,e=n.width,i=document;return void 0===e&&((t=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,i.body.appendChild(t),e=n.width=t.offsetWidth-t.clientWidth,i.body.removeChild(t)),e},r=function(){var s,r,o,a,l,h,c;if((r=(c=t("[data-group]",i.$dropdown_content)).length)&&i.$dropdown_content.width()){if(e.equalizeHeight){for(o=0,s=0;s<r;s++)o=Math.max(o,c.eq(s).height());c.css({height:o})}e.equalizeWidth&&(h=i.$dropdown_content.innerWidth()-n(),a=Math.round(h/r),c.css({width:a}),r>1&&(l=h-a*(r-1),c.eq(r-1).css({width:l})))}};(e.equalizeHeight||e.equalizeWidth)&&(F.after(this,"positionDropdown",r),F.after(this,"refreshOptions",r))}),E.define("remove_button",function(e){if("single"!==this.settings.mode){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var i=this,s='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+k(e.title)+'">'+e.label+"</a>",n=function(t,e){var i=t.search(/(<\/[^>]+>\s*)$/);return t.substring(0,i)+e+t.substring(i)},r;this.setup=(r=i.setup,function(){if(e.append){var o=i.settings.render.item;i.settings.render.item=function(t){return n(o.apply(this,arguments),s)}}r.apply(this,arguments),this.$control.on("click","."+e.className,function(e){if(e.preventDefault(),!i.isLocked){var s=t(e.currentTarget).parent();i.setActiveItem(s),i.deleteSelection()&&i.setCaret(i.items.length)}})})}}),E.define("restore_on_backspace",function(t){var e=this,i;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(i=e.onKeyDown,function(e){var s,n;return 8===e.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&(s=this.caretPos-1)>=0&&s<this.items.length?(n=this.options[this.items[s]],this.deleteSelection(e)&&(this.setTextboxValue(t.text.apply(this,[n])),this.refreshOptions(!0)),void e.preventDefault()):i.apply(this,arguments)})}),E}),void 0===Craft.FeedMe&&(Craft.FeedMe={}),$(function(){var t;($(document).on("click","#feeds .settings",function(t){t.preventDefault();var e=$(this).parents("tr").data("id")+"-settings",i;$('tr[data-settings-id="'+e+'"] .settings-pane').toggle()}),$(document).on("change","#elementType",function(){$(".element-select").hide();var t=$(this).val().replace(/\\/g,"-");$('.element-select[data-type="'+t+'"]').show();var e=$('[name="duplicateHandle"]').parent().find(".checkbox-group");"craft-elements-User"===t?e.find(":nth-child(3) label").html(Craft.t("feed-me","Suspend missing users")):e.find(":nth-child(3) label").html(Craft.t("feed-me","Disable missing elements")),console.log(t)}),$("#elementType").trigger("change"),$(document).on("change",".element-parent-group select",function(){var t,e,i=$(this).parents(".element-sub-group").data("items")["item_"+$(this).val()],s=$(".element-child-group select").val(),n='<option value="">'+Craft.t("feed-me","None")+"</option>";$.each(i,function(t,e){t&&(n+='<option value="'+t+'">'+e+"</option>")}),$(".element-child-group select").html(n),s?$(".element-child-group select").val(s):$($(".element-child-group select").children()[1]).attr("selected",!0)}),$(".element-parent-group select").trigger("change"),$(".feedme-uniques").length)&&($('.feedme-uniques input[type="checkbox"]:checked').length||$('.feedme-uniques input[type="checkbox"]:first').prop("checked",!0));$(".assets-uploads input").on("change",function(t){var e=$(this).parents(".field-extra-settings").find(".select"),i=$(this).parents(".field-extra-settings").find(".asset-label-hide");$(this).prop("checked")?(i.css({opacity:1,visibility:"visible"}),e.css({opacity:1,visibility:"visible"})):(i.css({opacity:0,visibility:"hidden"}),e.css({opacity:0,visibility:"hidden"}))}),$(".assets-uploads input").trigger("change"),$(".field-extra-settings .element-create input").on("change",function(t){var e=$(this).parents(".field-extra-settings").find(".element-groups");$(this).prop("checked")?e.show():e.hide()}),$(".field-extra-settings .element-create input").trigger("change"),$(".field-extra-settings .element-group-section select").on("change",function(t){var e=$(this).parents(".field-extra-settings").find(".element-group-entrytype"),i,s,n=e.data("items")["item_"+$(this).val()],r="";$.each(n,function(t,e){t&&(r+='<option value="'+t+'">'+e+"</option>")}),e.find("select").html(r)}),$(".field-extra-settings .element-group-section select").trigger("change"),$(".feedme-mapping .selectize select").selectize({allowEmptyOption:!0}),$(".subelement-toggle label").on("click",function(t){var e;$(this).parents(".subelement-toggle").find(".lightswitch").data("lightswitch").toggle()}),$(".subelement-toggle .lightswitch").on("change",function(t){var e=$(this).data("lightswitch"),i,s;$(this).parents("tr").nextUntil(":not(.element-sub-field)").toggle()}),$(".element-sub-field").each(function(t,e){var i,s,n=[$(this).find(".col-map select").val(),$(this).find(".col-default input").val()],r=!1,o,a;($.each(n,function(t,e){""!=e&&"noimport"!=e&&void 0!==e&&(r=!0)}),r)&&$(this).prevUntil(":not(.element-sub-field)").addBack().prev().find(".lightswitch").data("lightswitch").turnOn()}),$(document).on("click",".log-detail-link",function(t){t.preventDefault();var e=$(this).data("key");$('tr[data-key="'+e+'"]').toggleClass("hidden")}),$(document).on("click","input[data-action]",function(t){var e=$(this).parents("form"),i=$(this).data("action");e.find('input[name="action"]').val(i),e.submit()}),$(document).on("change",".log-type-form .select",function(t){t.preventDefault(),$(this).parents("form").submit()}),new Craft.FeedMe.TaskProgress}),function(){var t='<div><span data-icon="check"></span> '+Craft.t("feed-me","Processing complete!")+'</div><div class="feedme-success-btns"><a class="btn submit" href="'+Craft.getUrl("feed-me/feeds")+'">Back to Feeds</a><a class="btn" href="'+Craft.getUrl("feed-me/logs")+'">View logs</a></div>';Craft.FeedMe.TaskProgress=Garnish.Base.extend({runningTask:null,$spinnerScreen:null,$pendingScreen:null,$runningScreen:null,init:function(){this.$spinnerScreen=$(".feedme-status-spinner"),this.$pendingScreen=$(".feedme-fullpage.fullpage-waiting"),this.$runningScreen=$(".feedme-fullpage.fullpage-running"),this.updateTasks()},updateTasks:function(){Craft.postActionRequest("queue/get-job-info",$.proxy(function(t,e){"success"==e&&this.showTaskInfo(t[0])},this))},showTaskInfo:function(e){this.$spinnerScreen.addClass("hidden"),e?(this.$runningScreen.removeClass("hidden"),this.runningTask?this.runningTask.updateStatus(e):this.runningTask=new Craft.FeedMe.TaskProgress.Task(e),"error"!=e.status&&setTimeout($.proxy(this,"updateTasks"),500)):this.runningTask?this.runningTask.complete():this.$pendingScreen.hasClass("cp-triggered")?(this.$runningScreen.removeClass("hidden"),this.$runningScreen.find(".progress-container").html(t)):this.$pendingScreen.removeClass("hidden")}}),Craft.FeedMe.TaskProgress.Task=Garnish.Base.extend({progressBar:null,init:function(t){this.$statusContainer=$(".feedme-fullpage.fullpage-running .progress-container"),this.$statusContainer.empty(),this.progressBar=new Craft.ProgressBar(this.$statusContainer),this.progressBar.showProgressBar(),this.updateStatus(t)},updateStatus:function(t){this.progressBar.setProgressPercentage(t.progress),"error"==t.status&&this.fail()},complete:function(){this.progressBar.setProgressPercentage(100),setTimeout($.proxy(this,"success"),300)},success:function(){this.$statusContainer.html(t)},fail:function(){this.$statusContainer.html('<div class="error">'+Craft.t("feed-me",'Processing failed. <a class="go" href="'+Craft.getUrl("feed-me/logs")+'">View logs</a>')+"</div>")}})}();